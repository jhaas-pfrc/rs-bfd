



Network Working Group                                            R. Bush
Internet-Draft                                 Internet Initiative Japan
Intended status: Standards Track                                 J. Haas
Expires: January 2, 2017                                      J. Scudder
                                                  Juniper Networks, Inc.
                                                               A. Nipper
                                                            T. King, Ed.
                                                  DE-CIX Management GmbH
                                                               July 2016


        Making Route Servers Aware of Data Link Failures at IXPs
                        draft-ietf-idr-rs-bfd-02

Abstract

   When route servers are used, the data plane is not congruent with the
   control plane.  Therefore, the peers on the Internet exchange can
   lose data connectivity without the control plane being aware of it,
   and packets are dropped on the floor.  This document proposes the use
   of BFD between the two peering routers to detect a data plane
   failure, and then uses a newly defined BGP extended community -- RS-
   Reachable -- to signal the state of the data link to the route
   server(s).

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are to
   be interpreted as described in [RFC2119] only when they appear in all
   upper case.  They may also appear in lower or mixed case as English
   words, without normative meaning.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."




Bush, et al.             Expires January 2, 2017                [Page 1]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   This Internet-Draft will expire on January 2, 2017.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Operation . . . . . . . . . . . . . . . . . . . . . . . . . .   3
     2.1.  Mutual Discovery of Route Server Client Next-Hops . . . .   3
     2.2.  Tracking Connectivity . . . . . . . . . . . . . . . . . .   4
   3.  Advertising Client Router Connectivity to the Route Server  .   5
   4.  Advertising NHIB state in BGP . . . . . . . . . . . . . . . .   5
     4.1.  Using extended communities to carry NHIB state  . . . . .   5
       4.1.1.  The RS-Reachable Extended Community . . . . . . . . .   6
       4.1.2.  The RS-Reachable-v6 Extended Community  . . . . . . .   7
     4.2.  Advertising NHIB entries as BGP Routes  . . . . . . . . .   8
       4.2.1.  Procedures for the Router Receiving NHIB Entries  . .   8
     4.3.  Procedures for the Router Sending NHIB Entries  . . . . .  10
       4.3.1.  General Procedures  . . . . . . . . . . . . . . . . .  10
       4.3.2.  Specific Procedures for Route Server Clients  . . . .  10
   5.  Processing NHIB State Changes . . . . . . . . . . . . . . . .  10
     5.1.  Route Server Client Procedures for NHIB Changes . . . . .  10
     5.2.  Route Server Procedures for NHIB Changes  . . . . . . . .  11
   6.  Utilizing Next Hop Unreachability Information at Client
       Routers . . . . . . . . . . . . . . . . . . . . . . . . . . .  12
   7.  Recommendations for Using BFD . . . . . . . . . . . . . . . .  12
   8.  Bootstrapping . . . . . . . . . . . . . . . . . . . . . . . .  14
   9.  Capability Detection  . . . . . . . . . . . . . . . . . . . .  14
   10. Other Considerations  . . . . . . . . . . . . . . . . . . . .  14
   11. Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .  14
   12. References  . . . . . . . . . . . . . . . . . . . . . . . . .  14
     12.1.  Normative References . . . . . . . . . . . . . . . . . .  14
     12.2.  Informative References . . . . . . . . . . . . . . . . .  15
   Appendix A.  Summary of Adj-NHIB-In state . . . . . . . . . . . .  16
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  16



Bush, et al.             Expires January 2, 2017                [Page 2]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


1.  Introduction

   In configurations (typically Internet Exchange Points (IXPs)) where
   EBGP routing information is exchanged between client routers through
   the agency of a route server [RFC7947], but traffic is exchanged
   directly, operational issues can arise when partial data plane
   connectivity exists among the route server client routers.  Since the
   data plane is not congruent with the control plane, the client
   routers on the IXP can lose data connectivity without the control
   plane - the route server - being aware of it.

   To remedy this, two basic problems need to be solved:

   1.  Client routers must have a means of verifying connectivity
   amongst themselves, and

   2.  Client routers must have a means of communicating the knowledge
   so gained back to the route server.

   The first can be solved by application of Bidirectional Forwarding
   Detection [RFC5880].  The second can be solved by use of the BGP RS-
   Reachable extended community defined in this document.

   Throughout this document, we generally assume that the route server
   being discussed is able to represent different RIBs towards different
   clients, as discussed in section 2.3.2.1.  [RFC7947].  These
   procedures (other than the use of BFD to track next hop reachability)
   have limited value if this is not the case.

2.  Operation

   Below, we detail procedures where a route server tells its client
   routers about other client nexthops by sending it RS-Reachable
   extended communities, the client router verifies connectivity to
   those other client routers using BFD and communicates its findings
   back to the route server using RS-Reachable extended communities.
   The route server uses the received routes with RS-Reachable extended
   communities as input to the route selection process it performs on
   behalf of the client.

2.1.  Mutual Discovery of Route Server Client Next-Hops

   Strictly speaking, a client router of a route server doesn't need to
   know of other control-plane client routers.  Instead, for validation
   purposes, it needs to know all of the next hops that the route server
   might choose to send the client router; i.e., to know of potential
   forwarding plane relationships.




Bush, et al.             Expires January 2, 2017                [Page 3]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   In effect, this requirement amounts to knowing the BGP next hops the
   route server is aware of for the particular per-client Loc-RIB (see
   section 2.3.2.1.  [RFC7947]).  We introduce a new table for each
   client to store known next hops, their compatibility with this
   proposed solution and their learned reachability.  We call these
   tables per-client Next Hop Information Base (NHIB).  The NHIB is
   communicated to the Route Server using RS-Reachable extended
   communities on IXP-specific routes reserved for this purpose.

   At the route server, the NHIB for each client is populated with the
   next hops from its Loc-RIB.  If the BGP capabilities learned during
   BGP session setup identify a next hop as compatible with this
   proposal, this is reflected in the NHIB.  Initially, it is assumed
   that the client router is able to reach its next hops which is stored
   in the NHIB.

   If a next hop is added to the NHIB for a particular client, an entry
   SHOULD be added to the router server's Adj-NHIB-Out.  If a next hop
   is removed from a NHIB, the corresponding entry in the Adj-NHIB-Out
   MUST be removed.

   A route server client SHOULD use BFD [RFC5880] (or other means beyond
   the scope of this document) to track forwarding plane connectivity to
   each next hop depicted in the Adj-NHIB-Out.

2.2.  Tracking Connectivity

   For each next hop in the NHIB received from the route server (called
   Adj-NHIB-In), the client router SHOULD use some means to confirm that
   data plane connectivity exists to that next hop.

   The client router maintains its own NHIB in order to keep track of
   its (potential) next hops, their capabilities as learned from the
   route server, and their reachability.  The NHIB is updated according
   to the Adj-NHIB-In and client routers own tests to verify
   connectivity to next hops.

   For each next hop in the Adj-NHIB-In received from the route server,
   the client router SHOULD evaluate the next hop's compatibility with
   this proposal.  If the next hop supports this proposed mechanism, the
   client router SHOULD setup a BFD session to it if one is not already
   available and track the reachability of this next hop.

   For each nexthop that is determined to be reachable, an entry should
   be added in the client router's Adj-NHIB-Out to be advertised to the
   route server.  Similarly, when that nexthop is determined to no
   longer be reachable, the entry should be removed from the client




Bush, et al.             Expires January 2, 2017                [Page 4]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   router's Adj-NHIB-Out.  This may also be done as a result of policy
   even if connectivity exists.

   If the test of connectivity between one client router and another
   client router has failed, the client router that detected this
   failure should perform the connectivity test for a configurable
   amount of time (preferable 24 hours) on a regular basis (e.g. every 5
   minutes).  If during this time no connectivity can be restored no
   more testing is performed until manually changed or the client router
   is rebooted.

3.  Advertising Client Router Connectivity to the Route Server

   As discussed above, a client router will advertise its Adj-NHIB-Out
   to the route server.  The route server SHOULD update the reachability
   information of next hops in the client's NHIB table accordingly.
   Furthermore, the route server SHOULD use reachability information
   from the NHIB as input to its own decision process when computing the
   Adj-RIB-Out for this peer.  This peer-dependent Adj-RIB-Out is then
   advertised to this peer.  In particular, the route server MUST
   exclude any routes whose next hops the client has declared to be not
   reachable.

4.  Advertising NHIB state in BGP

   Two distinct pieces of per-peer state have been identified in the
   sections above:

   o  The next-hops for BGP routes received from the BGP speaker, the
      Adj-NHIB-In.
   o  The next-hops the BGP speaker is advertising existence, and
      potentially connectivity to, the Adj-NHIB-Out.

4.1.  Using extended communities to carry NHIB state

   A challenge in IXP route server environments is that it is common for
   only IPv4 and/or IPv6 unicast address family/sub-address family to be
   configured.  Thus, there is a desire to represent information in the
   NHIB solely within those address families.  This document proposes to
   carry NHIB entries in the form of BGP extended communities
   ([RFC4360], [RFC5701]) defined also in this document.

   Since BGP extended communities are advertised as attributes of a
   route, it is necessary to chose one or more IP prefixes for BGP's
   NLRI to carry these extended communities.  It is RECOMMENDED that
   these prefixes be chosen from the set of addresses considered
   "martian" and expected to be dropped by default by applications.




Bush, et al.             Expires January 2, 2017                [Page 5]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   This proposal suggests 127.254/16 as the range of IPv4 prefixes to
   carry these communities and the similar mapped IPv4 address of
   0::FFFF:127.254.0.0/112 for IPv6.  The procedure to exchange the NHIB
   using the communities bound to the prefixes is documented below.

   It is REQUIRED that BGP routes carrying NHIB state carry the BGP
   NO_ADVERTISE community [RFC1997] to prevent their propagation outside
   of the IXP BGP environment.  NHIB Routes not carrying the
   NO_ADVERTISE community MUST be ignored.

4.1.1.  The RS-Reachable Extended Community

   A new BGP extended community [RFC4360], RS-Reachable, is defined by
   this document.  RS-Reachable is an IPv4 Address Specific Extended
   Community with a Type of 0x41 (IANA Assigned, Non-Transitive) and a
   Sub-Type of TBD1.

   The Global Administrator field contains either an IPv4 next hop
   address to be stored in the receiving router's NHIB, or the lower two
   octets will store a counter value for the distinguished NHIB-Count
   prefix.  When the Global Administrator field contains the counter
   value, the remaining octets of that field MUST be set to zero and
   SHOULD be ignored upon receipt.

   The Local Administrator field is sub-divided to contain a field of 4
   flag bits, and an unsigned integer Generation ID.

      The C-bit corresponds to the advertising client role of the NHIB
      entry:

      0: The route server is advertising an IPv4 next hop to its route-
         server clients.
      1: A route server client is advertising an reachable IPv4 nexthop
         to the route server.

      The R bits are reserved and MUST be set to zero on transmission
      and SHOULD be ignored upon receipt.

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      0x41     | Sub-Type TBD1 |    IPv4 Nexthop (or zero)     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   IPv4 Nexthop (or counter)   |C R R R|     Generation ID     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+






Bush, et al.             Expires January 2, 2017                [Page 6]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


4.1.2.  The RS-Reachable-v6 Extended Community

   A new IPv6 Address Specific BGP extended community [RFC5701], RS-
   Reachable-v6, is defined by this document.  RS-Reachable-v6 is an
   IPv6 Address Specific Extended Community with a Type of 0x40 (Non-
   Transitive) and a Sub-Type of TBD2.

   The Global Administrator field either contains an IPv6 global next
   hop address to be stored in the receiving router's NHIB, or the lower
   two octets will store a counter value for the distinguished NHIB-
   Count prefix.  When the Global Administrator field contains the
   counter value, the remaining octets of that field MUST be set to zero
   and SHOULD be ignored upon receipt.

   [RFC2545] typically requires routers that are advertising IPv6 NLRI
   that are directly connected to advertise both an IPv6 global address
   and an IPv6 link-local address.  However, in the case where IPv6
   link-local peering is being used for route server purposes (TBD -
   insert draft-kato-bgp-ipv6-link-local ref here), a link-local address
   may be used in this field.

   The Local Administrator field is sub-divided to contain a field of 4
   flag bits, and an unsigned integer Generation ID.

      The C-bit corresponds to the advertising client role of the NHIB
      entry:

      0: The route server is advertising an IPv4 next hop to its route-
         server clients.
      1: A route server client is advertising an reachable IPv4 nexthop
         to the route server.

      The R bits are reserved and MUST be set to zero on transmission
      and SHOULD be ignored upon receipt.

       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |      0x40     | Sub-Type TBD2 |    IPv6 Nexthop (or zero)     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     IPv6 Nexthop (or zero)                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     IPv6 Nexthop (or zero)                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                     IPv6 Nexthop (or zero)                    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   IPv6 Nexthop (or counter)   |C R R R|     Generation ID     |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




Bush, et al.             Expires January 2, 2017                [Page 7]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


4.2.  Advertising NHIB entries as BGP Routes

   The primary challenge of carrying NHIB state in BGP is exchanging
   consistent sets of NHIB state.  The BGP specification does not
   mandate that its routes are distributed in any particular order.
   That specification also does not place any bounds on the time it
   takes to distribute its routes.  As a consequence, it is necessary to
   have a scheme whereby the multiple entries constituting the NHIB can
   be consistently exchanged.

   The necessary state for doing this exchange includes:

   o  Knowing the total number of NHIB entries to be exchanged.
   o  Grouping the NHIB entries into a consistent set, called a
      Generation.

   As noted above, the loopback address ranges of 127.254/16 and the
   similar IPv4 mapped range of 0::FFFF:127.254.0.0/112 are used for
   prefixes to carry RS-Reachable extended communities.

   The first address of this range, i.e. 127.254.0.0 or
   0::FFFF:127.254.0.0, is distinguished and is called the NHIB-Count
   prefix.  It will carry a single RS-Reachable extended community.  It
   will have the following properties:

   o  The last two octets of the Nexthop field (least significant
      octets) will carry the total number of NHIB entries, represented
      as an unsigned integer, in this generation of the NHIB.
   o  The Generation ID field is considered the "current generation
      value".

   It SHALL be considered an error to for this distinguished prefix to
   carry more than one RS-Reachable extended community.  In the event
   that more than one is received, the receiving BGP speaker MUST IGNORE
   the received NHIB state.

   The remaining addresses in these ranges will carry one or more RS-
   Reachable extended communities.  It is RECOMMENDED that these routes
   carry multiple communities to reduce the number of BGP routes that
   must be exchanged to synchronize NHIB state.

4.2.1.  Procedures for the Router Receiving NHIB Entries

4.2.1.1.  C-Bit Validation

   When a BGP speaker receives routes from the assigned NHIB prefix
   range, it examines each RS-Reachable extended community:




Bush, et al.             Expires January 2, 2017                [Page 8]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   o  If the BGP speaker is a route-server and receives routes with the
      C bit in the Local Administrator field set to 0, it discards this
      extended community.
   o  Similarly, if the BGP speaker is a route server client and
      receives routes with the C-bit set to 1, it discards this extended
      community.

   This procedure mitigates issues wherein the BGP speaker may be
   injecting inappropriate NHIB state to its peer.

4.2.1.2.  Generation ID Procedures

   When a BGP speaker receives routes with RS-Reachable extended
   communities with a valid C-bit, it examines its Adj-NHIB-In for that
   peer for the nexthop address of the RS-Reachable entry in question.

   If the received BGP NLRI is the distinguished NHIB-Count prefix:

   o  The route is evaluated to ensure it carries exactly one RS-
      Reachable prefix.  If it does not, the Adj-NHIB-In table for this
      BGP speaker is set to the Invalid state.  Otherwise, it is set to
      the Valid state.
   o  The Adj-NHIB-In-Pending-Count variable is set to the value carried
      in the final two octets of the RS-Reachable Global Administrator
      field.  The Adj-NHIB-In-Pending-Generation-ID variable is set from
      the Generation ID carried in the Local Administrator field of the
      community.

   If the received NLRI is NOT the distinguished NHIB-Count prefix:

   o  If no entry exists for that Adj-NHIB-In, it is added and the
      Generation ID is set to the value in the the community.
   o  If an entry exists, and its Generation ID is determined to have
      increased, the Generation ID for that entry is updated to the
      value contained in the community.

   The procedures documented in [RFC1982] can be used to determine if
   the Generation ID has increased.

   Once all valid RS-Reachable extended communities have been processed
   for a given BGP route, the Adj-NHIB-In for that peer is examined:

   o  The largest NHIB Generation ID, Adj-NHIB-In-Max-Generation-ID, is
      determined by examining all entries in that table.
   o  If the value of that Adj-NHIB-In-Max-Generation-ID is identical to
      the value of the Adj-NHIB-In-Pending-Generation-ID variable, and
      the count of NHIB entries containing that Generation ID is equal




Bush, et al.             Expires January 2, 2017                [Page 9]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


      to the Adj-NHIB-In-Pending-Count variable, all Adj-NHIB-In entries
      with a different Generation ID are deleted.

4.3.  Procedures for the Router Sending NHIB Entries

4.3.1.  General Procedures

   A Generation ID is state local to a Adj-NHIB-Out.  It is initialized
   to 0.

   When the contents of the Adj-NHIB-Out have changed, the NHIB-Count
   distinguished prefix will be created/updated with a RS-Reachable
   extended community placing the count of the entries in that Adj-NHIB-
   Out in the count field (contained within the Global Administrator
   field) placing the count of the entries in that Adj-NHIB-Out in the
   count field (contained within the Global Administrator field).  The
   Generation ID will be incremented, wrapping back to 0 if necessary.

4.3.2.  Specific Procedures for Route Server Clients

   A route server client SHALL always create an entry in its Adj-NHIB-
   Out for its clients, even if a next hop has not been received for
   this client.  This self-originated entry permits BFD sessions at the
   clients to be provisioned even if the route exchange via the route
   server is asymmetric and one router sends routes to the second router
   in the route server view but not vice versa.

5.  Processing NHIB State Changes

5.1.  Route Server Client Procedures for NHIB Changes

   When entries are added to the a Route server client's Adj-NHIB-In for
   a route server peering session, it will then attempt to verify
   connectivity to the BGP nexthop for that entry.  The procedure
   described in this specification utilizes BFD; other mechanisms are
   permitted but are out of scope of this document.

   If no existing BFD session exists to this nexthop, a BFD session is
   provisioned to that IP address and the Adj-NHIB-In Reachable state is
   set to Unknown.  Since this session requires the remote BFD session
   to also be provisioned, it may stay in the Down/AdminDown state for a
   period of time.

   Once the BFD session moves to the Up state, the Adj-NHIB-In Reachable
   state is set to Up.  This NHIB entry is now eligible to be placed in
   Adj-NHIB-Out table and distributed according to the procedures above.
   Additionally, local BGP route selection may be impacted by this
   state.  See section Section 6.



Bush, et al.             Expires January 2, 2017               [Page 10]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   When the BFD session transitions out of the Up state to the Down
   state, the Adj-NHIB-In Reachable state is set to Down.  The NHIB
   entry MUST be removed from the Adj-NHIB-Out table.  This informs the
   route server that the next hop is no longer reachable.

   If the BFD session transitions out of the Up state to the AdminDown
   state, the Adj-NHIB-In Reachable state is set to AdminDown.  It is
   RECOMMENDED that the NHIB entry NOT be removed from the Adj-NHIB-Out
   table.  AdminDown could imply one of two possible circumstances:

   o  The local BFD session has been deconfigured and BFD validation is
      no longer possible.  While the nexthop may still be usable, it is
      no longer able to be determined using BFD whether that can happen.
      Removing the entry from the Adj-NHIB-Out will inform the route
      server that the next hop is no longer reachable and may adversely
      impact the route server's view supplied to that route server
      client.
   o  The remote BFD session has been deconfigured with similar impact.

   An implementation of these procedures MUST provide an administrative
   mechanism to clear such AdminDown entries from the Adj-NHIB-Out
   table.

5.2.  Route Server Procedures for NHIB Changes

   A route server is tracking two distinct types of next hop state for
   its clients:

   o  The BGP next hops received from those clients' BGP routes.
   o  The Adj-NHIB-Out state from each client representing next hops
      that the clients have verified connectivity to.

   The route-server will place the collection of received BGP next hops
   from its clients into its per client Adj-NHIB-Out tables when at
   least one of the route server peers that supports this procedure has
   advertised the associated BGP capability.  It will then advertise
   them per the procedures above.  This informs the route server clients
   of the available BGP nexthops visible to the route server supporting
   this feature.

   In the event that a given client that supports this feature (per
   capability negoatiation) does not provide any routes containing BGP
   next hops that would be used to populate an Adj-NHIB-Out entry, the
   route server SHOULD advertise an entry for such a router using the
   provided self-originated entry.  This permits the provisioning of BFD
   peering sessions for continuity check when route exchange via the
   route server is asymmetric and one client has routes from a second
   client, but not vice-versa.



Bush, et al.             Expires January 2, 2017               [Page 11]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   A route server will not generally delete NHIB entries learned in its
   per client Adj-NHIB-In table.  It derives the following information
   from the presence and state, or absence, of an entry:

   o  When an entry is present, it means that the route server client
      has noted the BGP next hop from the route server and has validated
      connectivity to it.  Such an entry has the Received state of
      Active.
   o  When an entry was previously present, it means that the route
      server client previously had validated connectivity to that next
      hop and NO LONGER has connectivity to it.  Such an entry has the
      Received state of Cached.  The route server may choose to adjust
      what routes are present in that client's view (Adj-Rib-Out) based
      on that information according to local capability and
      configuration.
   o  When an entry is missing, i.e. never has been seen, the route
      server can't derive any information about the reachability of a
      given next hop from the perspective of the route server client.
      The route server SHOULD NOT negatively bias the client's view
      according to this information.

6.  Utilizing Next Hop Unreachability Information at Client Routers

   A client router detecting an unreachable next hop signals this
   information to the route server as described above.  Also, it treats
   the routes as unresolvable as per section 9.1.2.1 [RFC4271] and
   proceeds with route selection as normal.

   Changes in nexthop reachability via these mechanisms should receive
   some amount of consideration toward avoiding unnecessary route
   flapping.  Similar mechanisms exist in IGP implementations and should
   be applied to this scenario.

7.  Recommendations for Using BFD

   The RECOMMENDED way a client router can confirm the data plane
   connectivity to its next hops is available, is the use of BFD in
   asynchronous mode.  Echo mode MAY be used if both client routers
   running a BFD session support this.  The use of authentication in BFD
   is OPTIONAL as there is a certain level of trust between the
   operators of the client routers at a particular IXP.  If trust cannot
   be assumed, it is recommended to use pair-wise keys (how this can be
   achieved is outside the scope of this document).  The ttl/hop limit
   values as described in section 5 [RFC5881] MUST be obeyed in order to
   secure BFD sessions from packets coming from outside the IXP.






Bush, et al.             Expires January 2, 2017               [Page 12]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   There is interdependence between the functionality described in this
   document and BFD from an administrative point of view.  To streamline
   behaviour of different implementations the following is RECOMMENDED:

   o  If BFD is administratively shut down by the administrator of a
      client router then the functionality described in this document
      MUST also be administratively shut down.
   o  If the administrator enables the functionality described in this
      document on a client router then BFD MUST be automatically
      enabled.

   The following values of the BFD configuration of client routers (see
   section 6.8.1 [RFC5880]) are RECOMMENDED in order to allow a fast
   detection of lost data plane connectivity:

   o  DesiredMinTxInterval: 1,000,000 (microseconds)
   o  RequiredMinRxInterval: 1,000,000 (microseconds)
   o  DetectMult: 3

   The configuration values above are a trade-off between fast detection
   of data plane connectivity and the load client routers must handle
   keeping up the BFD communication.  Selecting smaller
   DesiredMinTxInterval and RequiredMinRxInterval values generates
   excessive BFD packets, especially at larger IXPs with many hundreds
   of client routers.

   The configuration values above are selected in order to handle brief
   interruptions in the data plane.  Otherwise, if a BFD session detects
   a brief data plane interruption to a particular client router, it
   will signal to the route server that it should remove routes from
   this client router and shortly thereafter to add the routes again.
   This is disruptive and computationally expensive on the route server.

   The configuration values above are also partially impacted by BGP
   advertisement time in reaction to events from BFD.  If the
   configuration values are selected so that BFD detects data plane
   interruptions faster than the BGP advertisement time, a data plane
   connectivity flap could be detected by BFD but the route server is
   not informed about it because BGP is not able to transport this
   information fast enough.

   As discussed, finding good configuration values is hard so a client
   router administrator MAY select better suited values depending on the
   special needs of the particular deployment.







Bush, et al.             Expires January 2, 2017               [Page 13]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


8.  Bootstrapping

   During route server start-up, it does not know anything about
   connectivity states between client routers.  So, the route server
   assumes optimistically that all client routers are able to reach each
   other unless told otherwise.

9.  Capability Detection

   Support for the procedures in this document is signaled between two
   BGP speakers using BGP Capabilities Advertisement [RFC5492].  The
   Capability Code field is set to TBD (to be assigned by IANA) and the
   Capability Length field is set to 4.  The Capability Value is defined
   as:

          0       7      15      23      31
          +-------+-------+-------+-------+
          |           Reserved            |
          +-------+-------+-------+-------+

   The Capability Value field represents a series of flag bits reserved
   for future extensions to this specification and for support of this
   version MUST be set to 0 on advertisement and SHOULD be ignored upon
   receipt.

10.  Other Considerations

   For purposes of routing stability, implementations may wish to apply
   hysteresis ("holddown") to next hops that have transitioned from
   reachable to unreachable and back.

11.  Acknowledgments

   The authors would like to thank the authors of
   [I-D.ietf-idr-bgp-nh-cost] for their work as it was a basis for this
   proposal.

12.  References

12.1.  Normative References

   [RFC1997]  Chandra, R., Traina, P., and T. Li, "BGP Communities
              Attribute", RFC 1997, DOI 10.17487/RFC1997, August 1996,
              <http://www.rfc-editor.org/info/rfc1997>.







Bush, et al.             Expires January 2, 2017               [Page 14]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC2545]  Marques, P. and F. Dupont, "Use of BGP-4 Multiprotocol
              Extensions for IPv6 Inter-Domain Routing", RFC 2545,
              DOI 10.17487/RFC2545, March 1999,
              <http://www.rfc-editor.org/info/rfc2545>.

   [RFC4271]  Rekhter, Y., Ed., Li, T., Ed., and S. Hares, Ed., "A
              Border Gateway Protocol 4 (BGP-4)", RFC 4271,
              DOI 10.17487/RFC4271, January 2006,
              <http://www.rfc-editor.org/info/rfc4271>.

   [RFC4360]  Sangli, S., Tappan, D., and Y. Rekhter, "BGP Extended
              Communities Attribute", RFC 4360, DOI 10.17487/RFC4360,
              February 2006, <http://www.rfc-editor.org/info/rfc4360>.

   [RFC5492]  Scudder, J. and R. Chandra, "Capabilities Advertisement
              with BGP-4", RFC 5492, DOI 10.17487/RFC5492, February
              2009, <http://www.rfc-editor.org/info/rfc5492>.

   [RFC5701]  Rekhter, Y., "IPv6 Address Specific BGP Extended Community
              Attribute", RFC 5701, DOI 10.17487/RFC5701, November 2009,
              <http://www.rfc-editor.org/info/rfc5701>.

   [RFC5880]  Katz, D. and D. Ward, "Bidirectional Forwarding Detection
              (BFD)", RFC 5880, DOI 10.17487/RFC5880, June 2010,
              <http://www.rfc-editor.org/info/rfc5880>.

   [RFC5881]  Katz, D. and D. Ward, "Bidirectional Forwarding Detection
              (BFD) for IPv4 and IPv6 (Single Hop)", RFC 5881,
              DOI 10.17487/RFC5881, June 2010,
              <http://www.rfc-editor.org/info/rfc5881>.

   [RFC7947]  Jasinska, E., Hilliard, N., Raszuk, R., and N. Bakker,
              "Internet Exchange BGP Route Server", RFC 7947,
              DOI 10.17487/RFC7947, September 2016,
              <http://www.rfc-editor.org/info/rfc7947>.

12.2.  Informative References

   [I-D.ietf-idr-bgp-nh-cost]
              Varlashkin, I., Raszuk, R., Patel, K., Bhardwaj, M., and
              S. Bayraktar, "Carrying next-hop cost information in BGP",
              draft-ietf-idr-bgp-nh-cost-02 (work in progress), May
              2015.



Bush, et al.             Expires January 2, 2017               [Page 15]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   [RFC1982]  Elz, R. and R. Bush, "Serial Number Arithmetic", RFC 1982,
              DOI 10.17487/RFC1982, August 1996,
              <http://www.rfc-editor.org/info/rfc1982>.

Appendix A.  Summary of Adj-NHIB-In state

   The Adj-NHIB-In state is maintained per BGP peering session.  It
   consists of per-peer state and per-peer, per-nexthop state.

    +-----------------------------------+----------------------------+
    | Client Role                       | (Route-Server |            |
    |                                   |  Route-Server-Client       |
    +-----------------------------------+----------------------------+
    | Table-State                       | (Valid | Invalid)          |
    +-----------------------------------+----------------------------+
    | Adj-NHIB-In-Pending-Generation-Id | <16-bit unsigned integer>  |
    +-----------------------------------+----------------------------+
    | Adj-NHIB-In-Pending-Count         | <16-bit unsigned integer>  |
    +-----------------------------------+----------------------------+
                 Fig. 1  Per-peer Adj-NHIB-In Table State


    +---------------------------+--------------------------------------+
    | NextHop                   | <IPv4 Address | IPv6 Address         |
    +---------------------------+--------------------------------------+
    | Generation-ID             | <16-bit unsigned integer>            |
    +---------------------------+--------------------------------------+
    | Reachable                 | (Unknown | Up | Down | AdminDown)    |
    +---------------------------+--------------------------------------+
               Fig. 2  Per-peer, per-nexthop  Adj-NHIB-In State


Authors' Addresses

   Randy Bush
   Internet Initiative Japan
   5147 Crystal Springs
   Bainbridge Island, Washington  98110
   US

   Email: randy@psg.com










Bush, et al.             Expires January 2, 2017               [Page 16]

Internet-Draft Making RSes aware of IXP Data Link Failures     July 2016


   Jeffrey Haas
   Juniper Networks, Inc.
   1133 Innovation Way
   Sunnyvale, CA  94089
   US

   Email: jhaas@juniper.net


   John G. Scudder
   Juniper Networks, Inc.
   1133 Innovation Way
   Sunnyvale, CA  94089
   US

   Email: jgs@juniper.net


   Arnold Nipper
   DE-CIX Management GmbH
   Lichtstrasse 43i
   Cologne  50825
   Germany

   Email: arnold.nipper@de-cix.net


   Thomas King (editor)
   DE-CIX Management GmbH
   Lichtstrasse 43i
   Cologne  50825
   Germany

   Email: thomas.king@de-cix.net

















Bush, et al.             Expires January 2, 2017               [Page 17]
